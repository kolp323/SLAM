### 3D−3D 位姿估计问题
假设有一组配对好的 3D 点（比如对两幅 RGB-D 图像进行了匹配）：  
$\boldsymbol{P} = \{ \boldsymbol{p}_1, \cdots, \boldsymbol{p}_n \}, \quad \boldsymbol{P}' = \{ \boldsymbol{p}'_1, \cdots, \boldsymbol{p}'_n \}$  
想要找一个欧氏变换 R, t，使得：  
$\forall i, \boldsymbol{p}_i = \boldsymbol{R} \boldsymbol{p}_i' + \boldsymbol{t}$

这个问题可以用迭代最近点（Iterative Closest Point，ICP）求解。   
3D−3D 位姿估计问题和相机模型并没有关系。  
在 RGB-D SLAM 中， 可以用这种方式估计相机位姿。ICP 的求解也分为两种方式：利用线性代数的求解（主要是 SVD），以及利用非线性优化方式的求解（类似于 Bundle Adjustment）。  

### SVD 方法  
ICP可以分为以下三个步骤求解：  
1. 计算两组点的质心位置 p, p′，然后计算每个点的去质心坐标：  

    $\boldsymbol{p} = \frac{1}{n} \sum_{i = 1}^{n} (\boldsymbol{p}_i), \quad \boldsymbol{p}' = \frac{1}{n} \sum_{i = 1}^{n} (\boldsymbol{p}'_i)$   

    $q_i = p_i - p, \quad q_i' = p_i' - p'$

2. 根据以下优化问题计算旋转矩阵：  

    $R^* = \arg \min_{R} \frac{1}{2} \sum_{i=1}^{n} \| \boldsymbol{q}_i - R \boldsymbol{q}_i' \|^2$

3. 根据第 2 步的 R 计算 t： $t^∗ = p − Rp′$    

其中，在第2步：  

展开关于 R 的误差项

$\frac{1}{2}\sum_{i = 1}^{n}\left\|\boldsymbol{q}_{i}-\boldsymbol{R}\boldsymbol{q}_{i}^{\prime}\right\|^{2}=\frac{1}{2}\sum_{i = 1}^{n}\boldsymbol{q}_{i}^{\mathrm{T}}\boldsymbol{q}_{i}+\boldsymbol{q}_{i}^{\prime\mathrm{T}}\boldsymbol{R}^{\mathrm{T}}\boldsymbol{R}\boldsymbol{q}_{i}^{\prime}-2\boldsymbol{q}_{i}^{\mathrm{T}}\boldsymbol{R}\boldsymbol{q}_{i}^{\prime}$  

第一项和 R 无关，第二项由于 $R^TR$ = $I$，也与 R 无关。因此实际上优化目标函数变为  
$$\sum_{i = 1}^{n} -\boldsymbol{q}_{i}^{\mathrm{T}}\boldsymbol{R}\boldsymbol{q}_{i}' = \sum_{i = 1}^{n} -\mathrm{tr}\left(\boldsymbol{R}\boldsymbol{q}_{i}'\boldsymbol{q}_{i}^{\mathrm{T}}\right) = -\mathrm{tr}\left(\boldsymbol{R}\sum_{i = 1}^{n}\boldsymbol{q}_{i}'\boldsymbol{q}_{i}^{\mathrm{T}}\right)$$

下面通过 SVD 解出上述问题中最优的 R：  
定义一个 3 × 3 的矩阵：$W = \sum_{i=1}^{n} \boldsymbol{q}_i \boldsymbol{q}_i'^{\mathrm{T}}$  
对 W 进行 SVD 分解，得： $W = UΣV^T $  
其中，Σ 为奇异值组成的对角矩阵，对角线元素从大到小排列，而 U 和 V 为正交矩阵。当 W 满秩时，最优旋转矩阵 $R = UV^T$  
然后按$t^∗ = p − Rp′$ 求解 t。


### 非线性优化方法
以李代数表达位姿时，目标函数可以写成 
$\min_{\boldsymbol{\xi}} = \frac{1}{2} \sum_{i = 1}^{n} \left\| \left( \boldsymbol{p}_i - \exp(\boldsymbol{\xi}^{\wedge}) \boldsymbol{p}_i' \right) \right\|_2^2$

使用李代数扰动模型不断迭代：  
$\frac{\partial e}{\partial \delta \boldsymbol{\xi}} = -(\exp(\boldsymbol{\xi}^{\wedge}) \boldsymbol{p}_i')^{\odot}$

在非线性优化中只需不断迭代，就能找到极小值。ICP 问题存在唯一 解或无穷多解的情况。在唯一解的情况下，只要能找到极小值解，那么这个极小值就是全局最优值，不会遇到局部极小的情况。这意味着已匹配点时求解 ICP可以任意选定初始值。  

这里的ICP是指已由图像特征给定了匹配的情况下进行位姿估计的问题。 在匹配已知的情况下，这个最小二乘问题具有解析解，所以并没有必要进行迭代优化。  
#### 对于深度已知的特征点，建模它们的 3D−3D 误差；
#### 对于深度未知的特征点，则建模 3D−2D 的重投影误差。可以将所有的误差放在同一个问题中考虑，使得求解更加方便。