单目相机和双目相机获取深度图的步骤有着本质上的不同，这源于它们获取信息的方式。双目相机利用几何原理，而单目相机则需要利用运动、先验知识或深度学习模型来推断深度。

---

### 双目相机获取深度图的步骤

双目相机模仿人眼，通过两台相机的视角差异来计算深度。这个过程通常分为以下四个核心步骤：

1.  **相机标定（Camera Calibration）**：
    * **目的**：获取两个相机的内部参数（如焦距、主点、畸变系数）以及它们之间的外部参数（即旋转矩阵 $R$ 和平移向量 $t$）。这些参数被称为双目相机的“基线”（baseline）。
    * **方法**：通常使用棋盘格或其他特定模式的标定板。在多个不同位置和角度拍摄标定板图像，然后使用标定算法（如张正友标定法）计算出这些参数。

2.  **图像校正（Image Rectification）**：
    * **目的**：通过相机标定得到的参数，对左右两张原始图像进行变换。校正后的图像就好像是由两台“理想”相机拍摄的，它们的成像平面完全共面且水平对齐。
    * **结果**：校正后，左右两张图像的对应点（同一个三维点在两张图像上的投影）会出现在同一行上。这极大地简化了后续的像素匹配工作，将其从二维搜索降维到一维搜索。

3.  **立体匹配（Stereo Matching）**：
    * **目的**：在校正后的左右图像中，寻找每一个像素点的对应点。
    * **核心概念**：**视差（Disparity）**。对于图像中的一个点，它在左图和右图中的位置差异就是视差。视差越大，说明物体离相机越近；视差越小，说明物体离相机越远。
    * **方法**：通过比较左右图像同一行上像素点的特征（如颜色、梯度或周围区域的像素块），找到最佳匹配。常用的算法有SAD（Sum of Absolute Differences）、SSD（Sum of Squared Differences）和各种基于图割（Graph Cut）、动态规划（Dynamic Programming）的方法，以及现代的深度学习方法。

4.  **深度计算（Depth Calculation）**：
    * **目的**：利用几何三角化原理，根据视差值计算每个像素点的实际深度。
    * **公式**：在校正过的双目系统中，深度 $Z$、焦距 $f$、基线长度 $B$ 和视差 $d$ 之间存在简单的关系：
        $$Z = \frac{f \cdot B}{d}$$
        通过这个公式，我们可以将每个像素的视差值转换为深度值，最终生成一张完整的深度图。

---

### 单目相机获取深度图的步骤

单目相机只提供一个视角的二维图像，因此无法直接使用双目相机的三角化原理。获取深度图通常需要依赖以下两种主要方法：

#### 方法一：基于运动恢复结构（Structure from Motion, SfM）

这种方法通过相机自身的移动来模拟双目视觉效果。

1.  **特征提取与匹配**：在相机移动时连续拍摄多张图像。在这些图像之间，提取并匹配特征点（如SIFT、ORB等）。
2.  **位姿估计**：利用这些匹配的特征点，通过运动恢复结构（SfM）或视觉里程计（Visual Odometry）算法来估计相机在每一帧之间的相对运动（位姿）。
3.  **三维点重建**：一旦知道相机的运动轨迹，就可以利用三角化原理，通过多张图像中的对应特征点来计算其在三维空间中的坐标。
4.  **生成稀疏或稠密深度图**：
    * **稀疏深度图**：直接将重建出的三维特征点投影回图像平面，得到只包含特征点的深度信息。
    * **稠密深度图**：对于没有特征点的区域，通常需要结合**多视图立体（Multi-View Stereo, MVS）**算法，通过像素级别的匹配来生成完整的深度图。

#### 方法二：基于深度学习

这是目前最主流的单目深度估计方法。它将深度估计看作一个**图像到图像的转换问题**。

1.  **数据准备与模型训练**：
    * **监督学习**：使用大规模数据集（如KITTI、NYU Depth V2），这些数据集中包含了RGB图像及其对应的真实深度图。模型（通常是编码-解码结构的卷积神经网络）会学习RGB图像中的各种视觉线索（如透视、遮挡、纹理、光影等），并将其映射到深度图。
    * **无监督或自监督学习**：为了避免对昂贵真实深度数据的依赖，研究者们开发了无监督方法。这种方法通常利用**立体匹配**或**视频序列**来训练模型。例如，模型可以被训练来预测相机运动和深度，从而将一张图像中的像素投影到另一张图像上。通过最小化投影误差，模型可以间接学习深度信息。

2.  **深度图预测**：
    * **模型推理**：一旦模型训练完成，就可以输入一张全新的单目图像。模型会根据它从大量数据中学到的视觉线索，为图像中的每个像素输出一个深度值。
    * **输出**：最终得到一张完整的深度图。深度图的准确性取决于模型的架构、训练数据的质量以及是否经过后处理优化。

总的来说，双目相机通过物理基线和三角化原理直接测量深度，过程更为直观和精确。而单目相机由于信息不足，必须依赖于**相机运动**或**预先训练好的模型**来推断深度，这使得它的算法更加复杂，但在灵活性和成本上更具优势。