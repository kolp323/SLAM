# 单目稠密建图：用运动换取深度

### 问题1：尺度模糊性（Scale Ambiguity）  
单个图像本身是一个二维投影，无法直接感知场景中物体的绝对深度。
### 解决方法：三角化得到相对深度
通过自身运动来产生视差，并利用三角化（Triangulation）原理来计算三维点的位置。    
三角化的数学模型基于对极几何（Epipolar Geometry）约束。  

**弱点**：
1. 由于相机位姿估计和像素匹配中不可避免的噪声，单次三角化得到的深度值往往非常不准确。
2. 由于单目相机**无法直接获取绝对深度**，即便通过三角化得到了场景的几何结构，也只是一个**与真实世界按比例缩放的模型**。除非有额外的已知尺度信息（如一个已知大小的物体），否则这种尺度模糊性将始终存在 。

### 问题二：如何克服三角化对匹配精度的敏感性
### 解决方法：块匹配
通常会结合极线约束和块匹配（Block Matching）算法来寻找对应点 。  
该方法首先利用对极几何确定搜索范围，即在第二张图像中，只沿着对应点的极线进行搜索 。接着，在极线上，算法不再只比较单个像素的灰度值，而是比较一个像素点周围的像素块（如5×5或7×7的区域）。  
块匹配通过定义一个代价函数来衡量两个像素块的相似性，例如像素块的颜色直方图的卡方距离。通过在极线上找到代价成本最大的像素块，即可确定最优的同名点，进而计算出该点的深度值 。这种方法利用了局部区域的纹理信息，比单纯的像素匹配更具鲁棒性，能够有效降低错误匹配的概率。  

### 问题三：如何降低单帧图像对的深度估计？
### 解决方法：深度滤波器融合多帧图像的深度观测结果  
基本思想：利用**多帧图像对同一三维点进行多次观测**，并通过概率模型来增量式地更新其深度估计。  
贝叶斯深度滤波器：将待估计的深度值建模为一个概率分布（通常是高斯分布），而不是一个单一的确定值。每当相机获得一个新的观测时，该观测被视为一个新的证据（或称似然），通过贝叶斯公式，将这个新证据融合到原有的深度概率分布中，从而得到一个更准确的、不确定性更低的新分布。这个预测-更新（Predict-Update）的递归过程可以持续进行，直到深度值收敛到一个稳定的、精确的估计值 。  
$$p(x_t|z_{1:t}) = \frac{p(z_t|x_t)p(x_t|z_{1:t - 1})}{p(z_t|z_{1:t - 1})}$$

其中，$z_t$是观测变量，$x_t$为实际的状态变量，$p(x_t|z_{1:t})$ 是当前时刻 t 的后验概率分布，$p(x_t|z_{1:t - 1})$ 是先验概率分布，$p(z_t|x_t)$ 是似然函数。    

在这个过程中，一个重要的数学技巧是采用逆深度（Inverse Depth，1/Z）作为状态变量。从而将无穷远点映射到0，使得所有点的深度都位于一个有限区间。  


