RGB-D相机（如Microsoft Kinect）是一种能够直接输出彩色图像（RGB）和深度图（Depth）的传感器。  
这类相机通常基于结构光（Structured Light）或飞行时间（Time of Flight, ToF）原理工作 。它们通过投射已知图案的光线或测量光线往返的时间，来直接计算场景中每个像素点的深度信息，从而消除了单目建图所固有的尺度模糊性。  

## 体素网格地图：稠密建图
基于RGB-D相机的**稠密建图方法**通常采用**体素网格地图（Voxel Grid Map）**作为其核心数据结构。

体素：是三维空间的离散化单位，可以理解为三维空间中的“像素”。体素网格地图将整个三维空间划分为一个个小立方体，每个立方体（即体素）都存储着关于该空间区域的信息。  

### KinectFusion算法
一个经典的体素网格建图算法是**KinectFusion**。其算法框架包含三个核心模块 ：  
一个经典的体素网格建图算法是KinectFusion 。其算法框架包含三个核心模块：

1. **表面测量**：将每一帧RGB-D相机输入的深度图，根据相机内参，转换为三维点云，并计算出**每个点的表面法线**。
2. **相机位姿估计**：采用点到平面ICP（Iterative Closest Point）算法，将当前帧的点云与基于上一帧位姿投影得到的全局三维模型进行配准，从而实时估计出相机的位姿。这种**帧到模型**的配准策略在一定程度上优于传统的“帧到帧”配准，能够有效解决轨迹漂移问题。
3. **场景融合与表示**：KinectFusion最关键的贡献在于其采用的截断符号距离函数（Truncated Signed Distance Function, TSDF）来表示和融合三维场景。

### TSDF模型

TSDF模型的核心思想是用一个带符号的距离值 $d$ 和一个权重 $w$ 来**表示每个体素**：  
- 距离值 $d$ 代表该体素中心到最近物体表面的有向距离：  
当 $d=0$ 时，表示该体素位于物体表面上；  
当 $d<0$ 时，表示体素在物体内部；  
当 $d>0$ 时，表示体素在物体外部。  
- 权重 $w$ 则代表了该距离值估计的**可信度**。

TSDF的融合过程是增量式的，每当获取一帧新的深度数据，都会对受影响的体素进行更新。  
对于某个体素x，其新的TSDF值和权重可以通过以下公式从旧值和新观测值中融合得到 ：   

$$V_i(x) = \frac{W_{i-1}(x)V_{i-1}(x) + w_i(x)v_i(x)}{W_{i-1}(x) + w_i(x)}$$

$$W_i(x) = W_{i-1}(x) + w_i(x)$$

其中，$V_i(x)$和$W_i(x)$是第$i$帧融合后的TSDF值和权重，$v_i(x)$和$w_i(x)$是第$i$帧观测到的TSDF值和权重。  

通过这种方式，TSDF模型能够将多帧有噪声的深度数据融合为一个全局一致且去噪的三维网格模型。  
然而，KinectFusion的原始版本存在一个显著局限：其体素网格被锁定在一个固定大小的物理空间中（例如$3m \times 3m$的立方体），无法用于大规模环境的建图。  

### 概率八叉树地图（OctoMap）：一种高效的稀疏表示  
八叉树是一种递归地将三维空间划分为**八个子空间**的树形数据结构。  
OctoMap的核心思想在于其稀疏性。它**只存储那些被占据或已知为空闲的体素节点**，而*那些未知的、完全空闲的、或完全被占据的**父节点***则*无需继续细分*，从而实现了对稀疏环境的内存高效表示。  

八叉树地图的更新过程基于**对数几率（Log-odds）的概率模型**，这是一个典型的贝叶斯概率更新过程 。  
每个八叉树**叶节点**都存储一个**对数几率值**，该值反映了**该体素被占据的概率**。  
当传感器（如激光雷达或RGB-D相机）获得新的观测时，系统会从相机位姿向三维空间中发射“虚拟射线”：  
- 射线穿过的所有体素，其被占据的对数几率都会减小（被标记为空闲） 。
- 射线末端（即被观测到的点）所在的体素，其被占据的对数几率会增加（被标记为占据）。  
（理解：一个三维空间点的光线能投影到相机平面上，其经过的路径上一定没有阻挡）  

通过将概率转换为对数几率，可以有效地将乘法形式的贝叶斯更新转化为加法形式，从而简化计算 :  

$$logodds(p)=\ln(\frac{p}{1 - p})$$

$$L_{new}(x)=L_{old}(x)+L_{sensor\_model}(x)$$

其中，p为概率值，$L(x)$为对数几率值。  

这种基于概率的八叉树地图不仅解决了大规模环境的存储问题，更重要的是，它提供了一种统一的、可融合的框架。  


