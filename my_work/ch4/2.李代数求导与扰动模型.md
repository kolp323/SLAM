## 总结
### 1. 指数映射的导数
对于一个旋转矩阵 $R = \exp(\phi^{\wedge})$，其导数可以写成：  
$\frac{\partial \exp(\phi^{\wedge})}{\partial \phi} = \mathbf{J}_r(\phi)$  
其中 Jr (ϕ) 是一个 3x3 矩阵，其表达式为：  
$\mathbf{J}_r(\boldsymbol{\phi}) = \mathbf{I} - \frac{1 - \cos\|\boldsymbol{\phi}\|}{\|\boldsymbol{\phi}\|^2}\boldsymbol{\phi}^\wedge + \frac{\|\boldsymbol{\phi}\| - \sin\|\boldsymbol{\phi}\|}{\|\boldsymbol{\phi}\|^3}(\boldsymbol{\phi}^\wedge)^2$

### 2. SO(3)上对 $\boldsymbol{R}\boldsymbol{p}$ 关于李代数 $\boldsymbol{\phi}$ 的求导过程

首先，我们引入一个微小的李代数扰动 $\boldsymbol{\delta\phi}$，它对应的微小旋转矩阵为 $\Delta\boldsymbol{R}$。

$$
\Delta\boldsymbol{R} = \exp(\boldsymbol{\delta\phi}^\wedge)
$$

当 $\boldsymbol{\delta\phi} \to 0$ 时，使用泰勒展开进行一阶近似：

$$
\Delta\boldsymbol{R} \approx \boldsymbol{I} + \boldsymbol{\delta\phi}^\wedge
$$

我们将这个扰动左乘到原来的旋转矩阵 $\boldsymbol{R}$ 上，得到扰动后的旋转矩阵 $\boldsymbol{R}'$：

$$
\boldsymbol{R}' = \Delta\boldsymbol{R} \cdot \boldsymbol{R} \approx (\boldsymbol{I} + \boldsymbol{\delta\phi}^\wedge) \boldsymbol{R}
$$

现在我们对函数 $f(\boldsymbol{R}) = \boldsymbol{R}\boldsymbol{p}$ 进行一阶泰勒展开，并求其增量：

$$
\begin{aligned}
\Delta f &= f(\boldsymbol{R}') - f(\boldsymbol{R}) \\
&= \boldsymbol{R}'\boldsymbol{p} - \boldsymbol{R}\boldsymbol{p} \\
&\approx (\boldsymbol{I} + \boldsymbol{\delta\phi}^\wedge) \boldsymbol{R}\boldsymbol{p} - \boldsymbol{R}\boldsymbol{p} \\
&= \boldsymbol{R}\boldsymbol{p} + \boldsymbol{\delta\phi}^\wedge \boldsymbol{R}\boldsymbol{p} - \boldsymbol{R}\boldsymbol{p} \\
&= \boldsymbol{\delta\phi}^\wedge (\boldsymbol{R}\boldsymbol{p})
\end{aligned}
$$

根据向量叉乘和反对称矩阵的关系 $\boldsymbol{v}^\wedge \boldsymbol{a} = -\boldsymbol{a}^\wedge \boldsymbol{v}$，我们将上式改写为：

$$
\Delta f \approx -(\boldsymbol{R}\boldsymbol{p})^\wedge \boldsymbol{\delta\phi}
$$

根据导数的定义，函数 $f(\boldsymbol{R})$ 关于扰动变量 $\boldsymbol{\delta\phi}$ 的雅可比矩阵 $\boldsymbol{J}$ 满足：

$$
\frac{\partial f}{\partial \boldsymbol{\delta\phi}} = \lim_{\boldsymbol{\delta\phi} \to 0} \frac{\Delta f}{\boldsymbol{\delta\phi}}
$$

所以，我们最终得到求导结果：

$$
\frac{\partial (\boldsymbol{R}\boldsymbol{p})}{\partial \boldsymbol{\phi}} = -(\boldsymbol{R}\boldsymbol{p})^\wedge
$$

### 3. SE(3)上对 $\boldsymbol{R}\boldsymbol{p}$ 关于李代数 $\boldsymbol{\phi}$ 的求导
假设某空间点p经过一次变换T（对应李代数为ξ），得到Tp 。给T左乘一个扰动$∆T = exp(δξ^∧)$，设扰动项的李代数为 $δξ = [δρ,δϕ]^T$，那么  
$
\frac{\partial(\boldsymbol{T}\boldsymbol{p})}{\partial\delta\boldsymbol{\xi}}  =\lim_{\delta\boldsymbol{\xi}\to0}\frac{\exp(\delta\boldsymbol{\xi}^{\wedge})\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}-\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}}{\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{(\boldsymbol{I}+\delta\boldsymbol{\xi}^{\wedge})\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}-\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}}{\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{\delta\boldsymbol{\xi}^{\wedge}\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}}{\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{\begin{bmatrix}
\delta\boldsymbol{\phi}^{\wedge}&\delta\boldsymbol{\rho}
\boldsymbol{0}^{\mathrm{T}}&0
\end{bmatrix}\begin{bmatrix}
\boldsymbol{R}\boldsymbol{p}+\boldsymbol{t}\\
1
\end{bmatrix}}{\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{\begin{bmatrix}
\delta\boldsymbol{\phi}^{\wedge}(\boldsymbol{R}\boldsymbol{p}+\boldsymbol{t})+\delta\boldsymbol{\rho}\\
\boldsymbol{0}^{\mathrm{T}}
\end{bmatrix}}{\delta\boldsymbol{\xi}}=\begin{bmatrix}
\boldsymbol{I}&-(\boldsymbol{R}\boldsymbol{p}+\boldsymbol{t})^{\wedge}\\
\boldsymbol{0}^{\mathrm{T}}&\boldsymbol{0}^{\mathrm{T}}
\end{bmatrix}\triangleq(\boldsymbol{T}\boldsymbol{p})^{\odot}
$  

把最后的结果定义成一个算符 ，它把一个齐次坐标的空间点变换成一个4×6的矩阵


--------------------------------------
-----------------------------------------
### BCH公式与近似形式
两个李代数指数映射乘积的完整形式，由 Baker-Campbell-Hausdorff公式（BCH公式）出:  
$\ln(\exp(\boldsymbol{A})\exp(\boldsymbol{B})) = \boldsymbol{A} + \boldsymbol{B} + \frac{1}{2}[\boldsymbol{A}, \boldsymbol{B}] + \frac{1}{12}[\boldsymbol{A}, [\boldsymbol{A}, \boldsymbol{B}]] - \frac{1}{12}[\boldsymbol{B}, [\boldsymbol{A}, \boldsymbol{B}]] + \cdots$  
其中 [] 为李括号。  

BCH 公式说明，当处理两个矩阵指数之积时，它们会产生一些由李括号组成的余项。特别地，考虑SO(3)上的李代数，**当ϕ1或ϕ2为小量时**，小于二次以上的项都可以被忽略掉。此时，**BCH拥有线性近似表达** ：    

$\ln(\exp(\hat{\phi_1})\exp(\hat{\phi_2}))^\vee \approx 
\begin{cases} 
J_l(\phi_2)^{-1}\phi_1 + \phi_2 & \text{当}\phi_1\text{为小量} \\
J_r(\phi_1)^{-1}\phi_2 + \phi_1 & \text{当}\phi_2\text{为小量}
\end{cases}$  

以第一个近似为例。该式说明，当对一个旋转矩阵R2（李代数为ϕ2）左乘一个微小旋转矩阵R1（李代数为ϕ1）时，可以近似地看作，在原有的李代数ϕ2上加上了一项$J_l(\phi_2)^{-1}\phi_1$。  
同理，第二个近似描述了右乘一个微小位移的情况。  
于是，李代数在BCH近似下，分成了左乘近似和右乘近似两种，在使用时我们须注意使用的是左乘模型还是右乘模型（即确认左边是小量还是右边是小量，左右乘两者的雅可比不同）。    

左乘 BCH 近似雅可比  

$\boldsymbol{J}_l = \boldsymbol{J} = \frac{\sin\theta}{\theta}\boldsymbol{I} + \left(1 - \frac{\sin\theta}{\theta}\right)\boldsymbol{a}\boldsymbol{a}^T + \frac{1 - \cos\theta}{\theta}\boldsymbol{a}^{\wedge}$  

它的逆为：  

$\boldsymbol{J}_l^{-1} = \frac{\theta}{2} \cot \frac{\theta}{2} \boldsymbol{I} + \left(1 - \frac{\theta}{2} \cot \frac{\theta}{2}\right) \boldsymbol{a} \boldsymbol{a}^{\mathrm{T}} - \frac{\theta}{2} \boldsymbol{a}^{\wedge}$  

右乘雅可比仅需要对自变量取负号即可变为左乘雅可比：  

$J_r(\phi) = J_l(-\phi)$
  

**BCH近似的意义**：  
假定对某个旋转R，对应的李代数为ϕ。我们给它左乘一个微小旋转，记作∆R，对应的李代数为∆ϕ。那么，在李群上，得到的结果就是∆R·R，而在李代数上，根据BCH近似，可以写成：$J_l^{-1}(\phi) \Delta \phi + \phi$  

合并式：
$\exp(\Delta\boldsymbol{\phi}^{\wedge})\exp(\boldsymbol{\phi}^{\wedge}) = \exp\left((\boldsymbol{\phi} + \boldsymbol{J}_l^{-1}(\boldsymbol{\phi})\Delta\boldsymbol{\phi})^{\wedge}\right)$  

反之，如果我们在李代数上进行加法，让一个ϕ加上 ∆ϕ，可以近似为李群上的左右雅可比的乘法：  
$\exp\left((\phi + \Delta\phi)^\wedge\right) = \exp\left((J_l\Delta\phi)^\wedge\right)\exp\left(\phi^\wedge\right) = \exp\left(\phi^\wedge\right)\exp\left((J_r\Delta\phi)^\wedge\right)$  

同样，对于SE(3)，亦有类似的BCH近似：  
$\exp(\Delta\xi^{\wedge})\exp(\xi^{\wedge})\approx\exp\left((\mathcal{J}_l^{-1}\Delta\xi + \xi)^{\wedge}\right)$

$\exp(\xi^{\wedge})\exp(\Delta\xi^{\wedge})\approx\exp\left((\mathcal{J}_r^{-1}\Delta\xi + \xi)^{\wedge}\right)$

### SO(3)李代数上的求导
在SLAM中，要估计一个相机的位置和姿态，该位姿是由SO(3)上的旋转矩阵或SE(3) 上的变换矩阵描述的。  
设某个时刻机器人的位姿为T，它观察到了一个世界坐标位于p的点，产生了一个观测数据z。由坐标变换关系知：  ​ z = Tp + w， 其中w为随机噪声。  
计算理想的观测与实际数据的误差：e =z−Tp  

假设一共有N个这样的路标点和观测，于是就有N个上式。那么，对机器人的位姿估计，相当于是寻找一个最优的T，使得整体误差最小化：  
$\min_{\boldsymbol{T}} J(\boldsymbol{T}) = \sum_{i = 1}^{N} \left\lVert \boldsymbol{z}_i - \boldsymbol{T} \boldsymbol{p}_i \right\rVert_2^2$  

求解此问题，需要计算目标函数J关于变换矩阵T的导数。  
如果把T当成一个普通矩阵来处理优化，那就必须对它加以约束；而如果在SO(3),SE(3)群中，并没有良好定义的加法。  
但从李代数角度，由于李代数由向量组成，具有良好的加法运算。  

**使用李代数解决求导问题的思路分为两种：**
1. 用李代数表示姿态，然后根据李代数加法来对李代数求导。
2. 对李群左乘或右乘微小扰动，然后对该扰动求导，称为左扰动和右扰动模型。  

第一种方式对应到李代数的求导模型，而第二种则对应到扰动模型。

### 李代数求导
考虑SO(3)上的情况。假设对一个空间点p进行了旋转，得到了新空间点Rp。  
计算旋转之后点的坐标相对于旋转的导数，记为 ：$\frac{\partial (Rp)}{\partial R}$  

由于SO(3)没有加法，所以该导数无法按照导数的定义进行计算。R对应的李代数为ϕ，转而计算 ：  
$\frac{\partial (\exp(\phi^{\wedge})p)}{\partial \phi} = \frac{\partial (\boldsymbol{Rp})}{\partial \boldsymbol{\phi}} = (-\boldsymbol{Rp})^{\land} \boldsymbol{J}_l$

### 扰动模型（左乘）
另一种求导方式是对R进行一次扰动∆R，看结果相对于扰动的变化率。这个扰动可以乘在左边也可以乘在右边，最后结果会有一点微小的差异。以左扰动为例，设左扰动∆R对应的李代数为φ。对φ求导，即：  
$\frac{\partial (\boldsymbol{Rp})}{\partial \boldsymbol{\varphi}} =$  
$ \lim_{\boldsymbol{\varphi} \to 0} \frac{\exp(\boldsymbol{\varphi}^{\wedge})\exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p} - \exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}}{\boldsymbol{\varphi}}$  

$= \lim_{\boldsymbol{\varphi} \to 0} \frac{(\boldsymbol{I} + \boldsymbol{\varphi}^{\wedge})\exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p} - \exp(\boldsymbol{\phi}^{\wedge})\boldsymbol{p}}{\boldsymbol{\varphi}}$  

$= \lim_{\boldsymbol{\varphi} \to 0} \frac{\boldsymbol{\varphi}^{\wedge}\boldsymbol{Rp}}{\boldsymbol{\varphi}}$  

$ = \lim_{\boldsymbol{\varphi} \to 0} \frac{-(\boldsymbol{Rp})^{\wedge}\boldsymbol{\varphi}}{\boldsymbol{\varphi}}$  
相比于直接对李代数求导，省去了一个雅可比矩阵的计算。这使得扰动模型更为实用，在位姿估计当中具有重要的意义。


### SE(3)上的李代数求导(扰动模型) 
假设某空间点p经过一次变换T（对应李代数为ξ），得到Tp 。给T左乘一个扰动$∆T = exp(δξ^∧)$，设扰动项的李代数为 $δξ = [δρ,δϕ]^T$，那么  
$
\frac{\partial(\boldsymbol{T}\boldsymbol{p})}{\partial\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{\exp(\delta\boldsymbol{\xi}^{\wedge})\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}-\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}}{\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{(\boldsymbol{I}+\delta\boldsymbol{\xi}^{\wedge})\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}-\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}}{\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{\delta\boldsymbol{\xi}^{\wedge}\exp(\boldsymbol{\xi}^{\wedge})\boldsymbol{p}}{\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{\begin{bmatrix}
\delta\boldsymbol{\phi}^{\wedge}&\delta\boldsymbol{\rho}
\boldsymbol{0}^{\mathrm{T}}&0
\end{bmatrix}\begin{bmatrix}
\boldsymbol{R}\boldsymbol{p}+\boldsymbol{t}\\
1
\end{bmatrix}}{\delta\boldsymbol{\xi}}$  

$=\lim_{\delta\boldsymbol{\xi}\to0}\frac{\begin{bmatrix}
\delta\boldsymbol{\phi}^{\wedge}(\boldsymbol{R}\boldsymbol{p}+\boldsymbol{t})+\delta\boldsymbol{\rho}\\
\boldsymbol{0}^{\mathrm{T}}
\end{bmatrix}}{\delta\boldsymbol{\xi}}=\begin{bmatrix}
\boldsymbol{I}&-(\boldsymbol{R}\boldsymbol{p}+\boldsymbol{t})^{\wedge}\\
\boldsymbol{0}^{\mathrm{T}}&\boldsymbol{0}^{\mathrm{T}}
\end{bmatrix}\triangleq(\boldsymbol{T}\boldsymbol{p})^{\odot}
$  

把最后的结果定义成一个算符 ，它把一个齐次坐标的空间点变换成一个4×6的矩阵
