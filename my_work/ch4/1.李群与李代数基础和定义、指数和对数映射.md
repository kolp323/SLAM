### 引入李群—李代数的原因： 
对SLAM中的旋转进行估计和优化时，一种典型的方式是把它构建成一个优化问题，求解最优的$R_t$，使得误差最小化。但旋转矩阵自身是带有约束的（正交且行列式为1）。它们作为优化变量时，会引入额外的约束，使优化变得困难。  
通过**李群—李代数间的转换关系**，我们希望**把位姿估计变成无约束的优化问题**，简化求解方式。  


三维旋转矩阵构成了特殊正交群 SO(3)，而变换矩阵构成了特殊欧氏群 SE(3)。  
旋转矩阵和变换矩阵**对加法是不封闭的**。   
这两种矩阵并没有良好定义的加法，相对的，它们只有一种较好的运算：乘法。这两种矩阵**关于乘法是封闭的**。  
乘法对应着旋转或变换的复合——两个旋转矩阵相乘表示做了两次旋转。这种只有一个运算的集合叫做群。  

### 李群
李群是指具有连续（光滑）性质的群。  
而SO(n)和SE(n)，它们在实数空间上是连续的。直观地想象一个刚体能够连续地在空间中运动，所以它们都是李群。  
SO(3)和SE(3)对于相机姿态估计尤其重要。

### 李代数
考虑任意旋转矩阵 R是某个相机的旋转，它会随时间连续地变化，即为时间的函数：R(t)。有：  
$R(t)R(t)^T = I$  

---------------------------
#### 先研究R(t)的导数
等式两边对时间求导，得到：  

$\dot{\boldsymbol{R}}(t)\boldsymbol{R}(t)^{\mathrm{T}}+\boldsymbol{R}(t)\dot{\boldsymbol{R}}(t)^{\mathrm{T}} = 0$  
$\dot{\boldsymbol{R}}(t)\boldsymbol{R}(t)^{\mathrm{T}} = -\left(\dot{\boldsymbol{R}}(t)\boldsymbol{R}(t)^{\mathrm{T}}\right)^{\mathrm{T}}$  

可以看出：$\dot{\boldsymbol{R}}(t)\boldsymbol{R}(t)^{\mathrm{T}}$ 是一个反对称矩阵.我们可以找到一个三维向量 ϕ(t) ∈ R3 与之对应：  
$\dot{\boldsymbol{R}}(t)\boldsymbol{R}(t)^{\mathrm{T}} = \boldsymbol{\phi}(t)^{\wedge}$  

由于R为正交阵，等式两边右乘 R(t),有：  

$\dot{\boldsymbol{R}}(t) = \boldsymbol{\phi}(t)^{\wedge} \boldsymbol{R}(t) = 
\begin{bmatrix}
0 & -\phi_3 & \phi_2 \\
\phi_3 & 0 & -\phi_1 \\
-\phi_2 & \phi_1 & 0
\end{bmatrix}
\boldsymbol{R}(t)$  

因此，每**对旋转矩阵求一次导数**，只需**左乘一个 ϕ(t)∧矩阵**（反对称矩阵）即可。

---------------------------
#### 再研究R(t)本身与ϕ(t)的联系
考虑 t0 = 0 时刻，设此时旋转矩阵为 R(0) = I。按照导数定义，可以把R(t) 在 t = 0 附近进行一阶泰勒展开：  
$\boldsymbol{R}(t) \approx \boldsymbol{R}(t_0) + \dot{\boldsymbol{R}}(t_0)(t - t_0) = \boldsymbol{I} + \boldsymbol{\phi}(t_0)^{\wedge}(t)$  

ϕ反映了R的导数性质，故称它在SO(3)原点附近的正切空间(Tangent Space)上。  
同时在 t0=0 附近，设ϕ(t0) = ϕ0，有:  
$\dot{\boldsymbol{R}}(t) = \boldsymbol{\phi}(t_0)^{\wedge} \boldsymbol{R}(t) = \boldsymbol{\phi}_0^{\wedge} \boldsymbol{R}(t)$  

由初始值 R(0) = I，求解关于R的微分方程：  
$R(t) = \exp(\phi_0^{\wedge} t)$  
说明在 t = 0 附近，旋转矩阵可以由 exp (ϕ0∧t)计算出来。  

----------------------
#### 综上
给定某时刻的R，我们就能求得一个ϕ，它描述了R在局部的导数关系。ϕ正是对应到 SO(3) 上的李代数so(3)；  
李群与李代数间的指数/对数映射，即李代数（ϕ）到李群（R）是指数关系，而李群（R）到李代数（ϕ）是对数关系。

### 李群与李代数
每个李群都有与之对应的李代数。李代数描述了李群的局部性质。  
李代数由一个集合V，一个数域 F 和一个二元运算 [, ] 组成，满足以下几条性质：  
1.封闭性  
2.双线性  
3.自反性（指自己与自己的运算为零）  
4.雅可比等价

其中二元运算被称为李括号。相比于群中的较为简单的二元运算，李括号表达了两个元素的差异。它不要求结合律，而只要求元素和自己做李括号之后为零的性质。  
三维向量R3上定义的叉积×是一种李括号，因此 g=(R3, R, ×) 构成了一个李代数。  

### 李代数so(3)
SO(3)对应的李代数是定义在R3上的向量，我们记作ϕ。每个ϕ都可以生成一个反对称矩阵：  

$\boldsymbol{\Phi} = \boldsymbol{\phi}^{\wedge} = 
\begin{bmatrix}
0 & -\phi_3 & \phi_2 \\
\phi_3 & 0 & -\phi_1 \\
-\phi_2 & \phi_1 & 0
\end{bmatrix}
\in \mathbb{R}^{3 \times 3}$  

在此定义下，两个向量 ϕ1, ϕ2 的李括号为： [ϕ1, ϕ2] = (Φ1Φ2 − Φ2Φ1) ∨  
向量ϕ与反对称矩阵是一一对应的，所以就说**so(3) 的元素是三维向量或者三维反对称矩阵**，不加区别。  

李代数是一个由三维向量组成的集合，每个向量对应到一个反对称矩阵，可以用于表达旋转矩阵的导数。 它与 SO(3) 的关系由指数映射给定：R = exp (ϕ∧)

### 李代数se(3)
se(3)位于R6空间中，把每个se(3)元素记作ξ，它是一个六维向量。  
前三维为平移，记作ρ；后三维为旋转，记作ϕ，实质上是so(3)元素。  
同时拓展了∧符号的含义，在se(3)中，同样使用∧符号，将一个六维向量转换成四维矩阵，但这里不再表示反对称：  

$\xi^{\wedge} = 
\begin{bmatrix}
\boldsymbol{\phi}^{\wedge} & \boldsymbol{\rho} \\
\boldsymbol{0}^{\mathrm{T}} & \boldsymbol{0}
\end{bmatrix}
\in \mathbb{R}^{4 \times 4}$  

即仍使用∧和∨符号来指代“从向量到矩阵”和“从矩阵到向量”的关系，以保持和so(3)的一致性。  
可以简单地把se(3)理解成“由一个平移加上一个so(3)元素构成的向量”。


### 指数与对数映射
任意矩阵的指数映射可以写成一个泰勒展开，但是只有在收敛的情况下才会有结果，其结果仍是一个矩阵: 

$\exp(A)=\sum_{n = 0}^{\infty}\frac{1}{n!}A^{n}$

### SO(3)上的指数映射
同样地，对so(3)中任意一元素ϕ，也定义它的指数映射：

$\exp(\phi^{\wedge}) = \sum_{n = 0}^{\infty} \frac{1}{n!} (\phi^{\wedge})^n$  

由于ϕ是三维向量，我定义它的模长和它的方向，分别记作θ和a，于是有 ϕ = θa。这里a是一个长度为1的方向向量。  
首先，对于a∧，有以下两条性质：

$\boldsymbol{a}^{\wedge}\boldsymbol{a}^{\wedge} = 
\begin{bmatrix}
 -a_{2}^{2}-a_{3}^{2} & a_{1}a_{2} & a_{1}a_{3} \\
 a_{1}a_{2} & -a_{1}^{2}-a_{3}^{2} & a_{2}a_{3} \\
 a_{1}a_{3} & a_{2}a_{3} & -a_{1}^{2}-a_{2}^{2}
\end{bmatrix} = \boldsymbol{aa}^{\mathrm{T}} - \boldsymbol{I}$  

$\boldsymbol{a}^{\wedge}\boldsymbol{a}^{\wedge}\boldsymbol{a}^{\wedge} = \boldsymbol{a}^{\wedge}(\boldsymbol{aa}^{\mathrm{T}} - \boldsymbol{I}) = -\boldsymbol{a}^{\wedge}$  

这提供了处理 a∧高阶项的方法。利用这两个性质，可以得到一个式子：  

$\exp(\theta \boldsymbol{a}^{\wedge}) = \cos\theta \boldsymbol{I} + (1 - \cos\theta)\boldsymbol{a}\boldsymbol{a}^{\mathrm{T}} + \sin\theta \boldsymbol{a}^{\wedge}$  
这和罗德里格斯公式如出一辄。  
  
通过这个公式，我们把so(3)中任意一个向量对应到了一个位于SO(3)中的旋转矩阵。  
若将SO(3)中的旋转矩阵对应到so(3)向量，没必要泰勒展开计算对数映射，可以根据旋转矩阵计算对应的李代数，利用迹的性质分别求解转角和转轴（分别对应模长θ和方向a）。

注：指数映射是一个满射，并不是单射。  
即旋转矩阵可以找到一个旋转向量对应。  
而多个旋转向量（旋转角有周期性）可以对应同一个旋转矩阵。 

SO(3)与so(3)的结论和前面讲的旋转向量与旋转矩阵很相似，而指数映射即是罗德里格斯公式。旋转矩阵的导数可以由旋转向量指定，指导着如何在旋转矩阵中进行微积分运算。

### SE(3)上的指数映射
se(3) 上的指数映射形式如下：  

$\exp(\xi^{\wedge}) = 
\begin{bmatrix}
\sum_{n = 0}^{\infty} \frac{1}{n!} (\phi^{\wedge})^n & \sum_{n = 0}^{\infty} \frac{1}{(n + 1)!} (\phi^{\wedge})^n \rho \\
\boldsymbol{0}^T & 1
\end{bmatrix}$

$\triangleq \begin{bmatrix}
R & J_{\rho} \\
\boldsymbol{0}^T & 1
\end{bmatrix} = T.$  

照着so(3)上的做法推导，把exp进行泰勒展开推导此式，得：  

$J = \frac{\sin\theta}{\theta} \boldsymbol{I} + \left(1 - \frac{\sin\theta}{\theta}\right) \boldsymbol{a}\boldsymbol{a}^T + \frac{1 - \cos\theta}{\theta} \boldsymbol{a}^{\wedge}$ 

该式与罗德里格斯有些相似。平移部分经过指数映射之后，发生了一次以J为系数矩阵的线性变换。

# 李群、李代数的定义与相互的转换关系总结：

## 三维旋转

### 李群
- $SO(3)$  
- $R \in \mathbb{R}^{3 \times 3}$  
- $RR^T = I$  
- $\det(R) = 1$

### 李代数
- $\mathfrak{so}(3)$  
- $\phi \in \mathbb{R}^3$  
- $\hat{\phi} = \begin{bmatrix} 0 & -\phi_3 & \phi_2 \\ \phi_3 & 0 & -\phi_1 \\ -\phi_2 & \phi_1 & 0 \end{bmatrix}$ 

### 指数映射：
$\exp(\theta \hat{a}) = \cos\theta I + (1 - \cos\theta)aa^T + \sin\theta \hat{a}$ 

### 对数映射：
$\theta = \arccos\frac{\text{tr}(R) - 1}{2}$  , $Ra = a$


## 三维变换

### 李群
- $SE(3)$
- $T \in \mathbb{R}^{4 \times 4}$
- $T = \begin{bmatrix} R & t \\ 0^T & 1 \end{bmatrix}$

### 李代数
- $\mathfrak{se}(3)$
- $\xi = \begin{bmatrix} \rho \\ \phi \end{bmatrix} \in \mathbb{R}^6$
- $\xi^{\wedge} = \begin{bmatrix} \hat{\phi} & \rho \\ 0^T & 0 \end{bmatrix}$

### 指数映射：
$\exp(\xi^\wedge) = \begin{bmatrix} \exp(\hat{\phi}) & J\rho \\ 0^T & 1 \end{bmatrix}$  

其中 $J = \frac{\sin\theta}{\theta}I + (1 - \frac{\sin\theta}{\theta})aa^T + \frac{1 - \cos\theta}{\theta}\hat{a}$  

### 对数映射：
$\theta = \arccos\frac{\text{tr}(R) - 1}{2}$，$Ra = a$，$t = J\rho$
